<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Sales Automation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 800px;
        }
        .card {
            transition: transform 0.2s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

    <div class="container my-5">
        <div class="text-center mb-4">
            <h1 class="display-5">AI-Powered LinkedIn Automation</h1>
            <p class="lead">Define your campaign criteria to find prospects and generate hyper-personalized messages.</p>
        </div>

        <div class="card p-4">
            <form id="campaign-form">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="ideal_job_roles" class="form-label">Ideal Job Roles</label>
                        <input type="text" class="form-control" id="ideal_job_roles" value="Software Engineer" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="region_location" class="form-label">Region/Location</label>
                        <input type="text" class="form-control" id="region_location" value="Bengaluru" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="product_description" class="form-label">Product/Service Description</label>
                    <textarea class="form-control" id="product_description" rows="3" required>An AI-powered service that helps startups with their financial planning.</textarea>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="target_industry" class="form-label">Target Industry</label>
                        <input type="text" class="form-control" id="target_industry" value="Technology" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="outreach_goal" class="form-label">Outreach Goal</label>
                        <input type="text" class="form-control" id="outreach_goal" value="Schedule a brief chat" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="brand_voice" class="form-label">Brand Voice</label>
                        <select class="form-select" id="brand_voice">
                            <option>Friendly and direct</option>
                            <option>Formal</option>
                            <option>Enthusiastic</option>
                            <option>Casual</option>
                        </select>
                    </div>
                </div>
                <div class="d-grid">
                    <button type="submit" id="submit-button" class="btn btn-primary btn-lg">
                        Start Campaign
                    </button>
                </div>
            </form>
        </div>

        <div class="mt-5">
            <div id="loading-spinner" class="text-center d-none">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Searching for prospects and generating messages... This may take several minutes.</p>
            </div>
            <div id="results-container">
                </div>
        </div>
    </div>

    <script>
        const campaignForm = document.getElementById('campaign-form');
        const submitButton = document.getElementById('submit-button');
        const loadingSpinner = document.getElementById('loading-spinner');
        const resultsContainer = document.getElementById('results-container');

        campaignForm.addEventListener('submit', async (event) => {
            // Prevent the default form submission behavior
            event.preventDefault();

            // --- 1. Update UI to show loading state ---
            submitButton.disabled = true;
            submitButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Working...';
            loadingSpinner.classList.remove('d-none'); // Show the spinner
            resultsContainer.innerHTML = ''; // Clear previous results

            // --- 2. Gather all the data from the form ---
            const formData = {
                ideal_job_roles: document.getElementById('ideal_job_roles').value,
                region_location: document.getElementById('region_location').value,
                product_description: document.getElementById('product_description').value,
                target_industry: document.getElementById('target_industry').value,
                outreach_goal: document.getElementById('outreach_goal').value,
                brand_voice: document.getElementById('brand_voice').value
            };

            // --- 3. Make the API call to the Python backend ---
            try {
                const response = await fetch('http://127.0.0.1:8000/api/start-campaign', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });

                if (!response.ok) {
                    // Handle HTTP errors like 404 or 500
                    const errorData = await response.json();
                    throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
                }

                const results = await response.json();
                displayResults(results);

            } catch (error) {
                // Handle network errors or errors thrown from the !response.ok check
                console.error('Error during campaign execution:', error);
                displayError(error.message);
            } finally {
                // --- 5. Reset UI after completion (success or fail) ---
                submitButton.disabled = false;
                submitButton.innerHTML = 'Start Campaign';
                loadingSpinner.classList.add('d-none'); // Hide the spinner
            }
        });

        function displayResults(results) {
            if (results.length === 0) {
                resultsContainer.innerHTML = '<div class="alert alert-warning">No results found, but the campaign completed successfully.</div>';
                return;
            }

            // Loop through each result and create a Bootstrap card for it
            results.forEach(result => {
                const card = `
                    <div class="card mb-3">
                        <div class="card-header">
                            <a href="${result.profile_url}" target="_blank">${result.profile_url}</a>
                        </div>
                        <div class="card-body">
                            <h6 class="card-subtitle mb-2 text-muted">AI Thought Process:</h6>
                            <p class="card-text fst-italic">"${result.thought_process}"</p>
                            <hr>
                            <h6 class="card-subtitle mb-2 text-muted">Generated Message:</h6>
                            <p class="card-text fw-bold">"${result.personalized_message}"</p>
                        </div>
                    </div>
                `;
                resultsContainer.innerHTML += card;
            });
        }

        function displayError(errorMessage) {
            resultsContainer.innerHTML = `<div class="alert alert-danger">An error occurred: ${errorMessage}</div>`;
        }

    </script>

</body>
</html>